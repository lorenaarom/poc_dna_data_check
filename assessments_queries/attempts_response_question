select row_number() over ()::int as row_number,
    att.district_id,
    id as attempt_id,
    att.school_id,
    att.assessment_id,
    att.assignee_id,
    response.ordinality::int as response_order,
    (response.value->>'externalItemId')::varchar(100) as response_external_item_id,
    question.ordinality::int as question_order,
    (question.value->>'score')::numeric(4, 2) as question_score,
    (question.value->>'maxScore')::numeric(4, 2) as question_max_score,
    (question.value->>'attempted')::boolean as question_attempted,
    (question.value->>'questionType')::varchar(50) as question_type,
    (question.value->>'externalQuestionId')::varchar(100) as external_question_id,
    (question.value->>'externalResponseId')::varchar(100) as external_response_id,
    att.created_at,
    att.updated_at,
    att.deleted_at,
    'data_pipeline' as inserted_by,
    NOW()::TIMESTAMP as inserted_at
from attempts att,
    lateral jsonb_array_elements(att.responses) with ordinality response(value),
    lateral jsonb_array_elements(response.value->'responses') with ordinality question(value)
where att.deleted = false